# Advanced Logging

## [ ] kubectl logs -l app=myapp --tail=100

### kubectl logs -l (Label-Based Log Collection)
```bash
# Get logs from all pods with specific label
kubectl logs -l app=myapp

# Get logs from labeled pods with tail
kubectl logs -l app=myapp --tail=100

# Follow logs from labeled pods
kubectl logs -l app=myapp -f

# Get logs from pods with multiple labels
kubectl logs -l app=myapp,version=v1.0

# Get logs from pods matching label selector
kubectl logs -l environment=production,tier=frontend

# Get logs from labeled pods with timestamps
kubectl logs -l app=myapp --timestamps

# Get logs from labeled pods since specific time
kubectl logs -l app=myapp --since=1h
```

### Advanced Log Filtering
```bash
# Combine tail with other options
kubectl logs -l app=myapp --tail=100 --timestamps

# Get logs from labeled pods in specific namespace
kubectl logs -l app=myapp -n production --tail=100

# Follow logs from labeled pods with tail
kubectl logs -l app=myapp -f --tail=50

# Get previous logs from labeled pods
kubectl logs -l app=myapp --previous --tail=100

# Get logs from all containers in labeled pods
kubectl logs -l app=myapp --all-containers=true --tail=100
```

## Deployment and Service Logs

### Deployment Logs
```bash
# Get logs from all pods in a deployment
kubectl logs deployment/<deployment-name>

# Follow deployment logs
kubectl logs deployment/<deployment-name> -f

# Get deployment logs with tail
kubectl logs deployment/<deployment-name> --tail=100

# Get deployment logs with timestamps
kubectl logs deployment/<deployment-name> --timestamps

# Get previous logs from deployment pods
kubectl logs deployment/<deployment-name> --previous
```

### Service Logs
```bash
# Get logs from pods behind a service
kubectl logs service/<service-name>

# Follow service logs
kubectl logs service/<service-name> -f

# Get service logs with tail
kubectl logs service/<service-name> --tail=100

# Note: This gets logs from all pods selected by the service
```

### ReplicaSet Logs
```bash
# Get logs from specific replica set
kubectl logs rs/<replicaset-name>

# Follow replica set logs
kubectl logs rs/<replicaset-name> -f

# Get replica set logs with tail
kubectl logs rs/<replicaset-name> --tail=100
```

## Advanced Log Analysis

### Searching Words in Logs
```bash
# Windows PowerShell (recommended for Windows)
kubectl logs <pod-name> | Select-String "error"

# Windows PowerShell case-insensitive (default)
kubectl logs <pod-name> | Select-String "ERROR"

# Search for multiple patterns (PowerShell)
kubectl logs <pod-name> | Select-String -Pattern "error","warning","fail"

# Search with context (PowerShell)
kubectl logs <pod-name> | Select-String "exception" -Context 2,3  # 2 before, 3 after

# Search in labeled pods (PowerShell)
kubectl logs -l app=myapp | Select-String "database"

# Search in deployment logs (PowerShell)
kubectl logs deployment/nginx | Select-String "started"

# Linux/Mac or Git Bash/WSL (if available)
kubectl logs <pod-name> | grep "error"
kubectl logs <pod-name> | grep -i "ERROR"
kubectl logs <pod-name> | grep -E "error|warning|fail"
```

### Advanced Search Patterns
```bash
# Windows PowerShell patterns
kubectl logs <pod-name> | Select-String -Pattern "\berror\b"      # Exact word match
kubectl logs <pod-name> | Select-String "error" -NotMatch         # Lines NOT containing word
kubectl logs <pod-name> | Select-String "HTTP \d+" -AllMatches    # Regex pattern
kubectl logs <pod-name> | Where-Object { $_ -notlike "*debug*" }  # Exclude debug lines

# Count occurrences (PowerShell)
(kubectl logs <pod-name> | Select-String "error").Count

# Search in specific time range (PowerShell)
kubectl logs <pod-name> --since=1h | Select-String "timeout"

# Linux/Mac/WSL patterns (if available)
kubectl logs <pod-name> | grep "\berror\b"        # Exact word
kubectl logs <pod-name> | grep -v "debug"         # Exclude lines
kubectl logs <pod-name> | grep -c "error"         # Count occurrences
kubectl logs <pod-name> | grep -n "exception"     # With line numbers
```

### Complex Label Selectors
```bash
# OR condition (comma-separated)
kubectl logs -l "app=web,app=api" --tail=100

# AND condition (space-separated)
kubectl logs -l app=web,environment=production --tail=100

# Exclusion (not equal)
kubectl logs -l app=web,environment!=development --tail=100

# Set-based selectors
kubectl logs -l 'app in (web,api)' --tail=100
kubectl logs -l 'environment notin (test,dev)' --tail=100
```

### Log Aggregation Patterns
```bash
# Get logs from all frontend components
kubectl logs -l tier=frontend --tail=100

# Get logs from all components of an application
kubectl logs -l app=ecommerce --tail=100

# Get logs from specific version deployment
kubectl logs -l app=myapp,version=v2.0 --tail=100

# Get logs from critical severity pods
kubectl logs -l severity=critical --tail=100
```

## Performance and Efficiency

### Limiting Log Output
```bash
# Limit to last 100 lines from each pod
kubectl logs -l app=myapp --tail=100

# Limit to last 50 lines and follow
kubectl logs -l app=myapp --tail=50 -f

# Limit by time range
kubectl logs -l app=myapp --since=30m --tail=200

# Limit output size
kubectl logs -l app=myapp --limit-bytes=1048576  # 1MB limit
```

### Efficient Log Monitoring
```bash
# Monitor specific application components
kubectl logs -l component=database --tail=100 -f

# Monitor error-prone services (PowerShell)
kubectl logs -l app=payment-service --tail=100 | Select-String -Pattern "error","exception"

# Monitor with timestamps for correlation
kubectl logs -l app=myapp --tail=100 --timestamps
```

## Real-World Use Cases

### Application Monitoring
```bash
# Monitor all microservices of an application
kubectl logs -l app=online-store --tail=50 -f

# Monitor specific environment
kubectl logs -l environment=production --tail=100 -n production

# Monitor by tier (frontend, backend, database)
kubectl logs -l tier=backend --tail=100
```

### Debugging Distributed Systems
```bash
# Get logs from all related services
kubectl logs -l system=payment --tail=100

# Monitor request flow across services
kubectl logs -l trace-id=12345 --tail=100

# Debug specific version rollout
kubectl logs -l app=myapp,version=canary --tail=100
```

### Performance Analysis
```bash
# Monitor high-traffic services
kubectl logs -l load=high --tail=200 -f

# Analyze logs from scaled deployments
kubectl logs -l app=web-server --tail=100 | grep "response_time"

# Monitor resource-intensive operations
kubectl logs -l job-type=batch --tail=100
```

## Quick Reference Examples

```bash
# Advanced logging patterns
kubectl logs -l app=myapp --tail=100                    # Last 100 lines from labeled pods
kubectl logs -l tier=frontend -f --tail=50             # Follow frontend logs
kubectl logs deployment/web-app --tail=100             # Deployment logs
kubectl logs -l app=myapp --since=1h --tail=200        # Time-filtered logs

# Searching in logs (Windows PowerShell)
kubectl logs <pod-name> | Select-String "error"                 # Search for errors
kubectl logs -l app=myapp | Select-String "warning"             # Search in labeled pods
kubectl logs deployment/nginx | Select-String "started" -Context 1,1  # Search with context
kubectl logs <pod-name> --tail=100 | Select-String "debug" -NotMatch   # Exclude debug messages

# Real-world scenarios
kubectl logs -l environment=prod --tail=100 | grep ERROR   # Production errors
kubectl logs -l version=canary -f --tail=50               # Canary deployment monitoring
kubectl logs -l app=payment --tail=100 --timestamps       # Payment service with timestamps
```

## Best Practices

1. **Use appropriate tail values**: Don't retrieve more logs than needed
2. **Combine with grep**: Filter logs after retrieval for specific patterns
3. **Use timestamps**: For correlating events across multiple pods
4. **Monitor resource usage**: Large log retrievals can impact cluster performance
5. **Label consistently**: Establish good labeling practices for effective log aggregation