# Deployments

## [ ] kubectl get deployments, kubectl scale deployment, kubectl rollout status/history/undo

### kubectl get deployments
```bash
# Get all deployments in current namespace
kubectl get deployments

# Get deployments with detailed information
kubectl get deployments -o wide

# Get deployments from all namespaces
kubectl get deployments --all-namespaces
kubectl get deployments -A

# Get specific deployment
kubectl get deployment <deployment-name>

# Watch deployments for changes
kubectl get deployments -w

# Get deployments with labels
kubectl get deployments -l app=myapp

# Custom output formats
kubectl get deployments -o yaml
kubectl get deployments -o json

# Show deployment with replica information
kubectl get deployments --show-labels
```

### kubectl scale deployment
```bash
# Scale deployment to specific number of replicas
kubectl scale deployment <deployment-name> --replicas=5

# Scale deployment in specific namespace
kubectl scale deployment <deployment-name> --replicas=3 -n <namespace>

# Scale multiple deployments at once
kubectl scale deployment web-app api-service --replicas=2

# Scale with conditions (only if current replicas match)
kubectl scale deployment <deployment-name> --current-replicas=2 --replicas=3

# Check current scale
kubectl get deployment <deployment-name>

# Scale to zero (stop all pods)
kubectl scale deployment <deployment-name> --replicas=0

# Auto-scale setup (HorizontalPodAutoscaler)
kubectl autoscale deployment <deployment-name> --min=2 --max=10 --cpu-percent=70

# Check autoscaler status
kubectl get hpa
kubectl describe hpa <deployment-name>
```

### kubectl rollout status
```bash
# Check rollout status of a deployment
kubectl rollout status deployment/<deployment-name>

# Check status with timeout
kubectl rollout status deployment/<deployment-name> --timeout=300s

# Watch rollout progress in real-time
kubectl rollout status deployment/<deployment-name> -w

# Check if rollout is complete
kubectl rollout status deployment/<deployment-name> --watch=false

# Check rollout status for different resource types
kubectl rollout status daemonset/<daemonset-name>
kubectl rollout status statefulset/<statefulset-name>
```

### kubectl rollout history
```bash
# View rollout history
kubectl rollout history deployment/<deployment-name>

# View specific revision details
kubectl rollout history deployment/<deployment-name> --revision=2

# View history with more details
kubectl rollout history deployment/<deployment-name> --revision=1 -o yaml

# Compare two revisions
kubectl rollout history deployment/<deployment-name> --revision=2 -o yaml
kubectl rollout history deployment/<deployment-name> --revision=3 -o yaml

# View change cause (if recorded)
kubectl annotate deployment/<deployment-name> deployment.kubernetes.io/change-cause="Updated to nginx 1.21"
kubectl rollout history deployment/<deployment-name>
```

### kubectl rollout undo
```bash
# Rollback to previous version
kubectl rollout undo deployment/<deployment-name>

# Rollback to specific revision
kubectl rollout undo deployment/<deployment-name> --to-revision=2

# Rollback with dry-run (preview changes)
kubectl rollout undo deployment/<deployment-name> --dry-run=client

# Rollback and monitor
kubectl rollout undo deployment/<deployment-name>
kubectl rollout status deployment/<deployment-name>

# Rollback other resource types
kubectl rollout undo daemonset/<daemonset-name>
kubectl rollout undo statefulset/<statefulset-name>
```

## Common Deployment Operations

```bash
# Create deployment
kubectl create deployment nginx-app --image=nginx:1.21

# Update deployment image
kubectl set image deployment/nginx-app nginx=nginx:1.22

# Restart deployment (rolling restart)
kubectl rollout restart deployment/nginx-app

# Pause rollout
kubectl rollout pause deployment/nginx-app

# Resume rollout
kubectl rollout resume deployment/nginx-app

# Check deployment details
kubectl describe deployment nginx-app
```

## Deployment Status Fields

| Field | Description |
|-------|-------------|
| READY | Number of ready replicas vs desired |
| UP-TO-DATE | Number of replicas with latest configuration |
| AVAILABLE | Number of replicas available to users |
| AGE | Time since deployment creation |

## Quick Reference Workflow

```bash
# Standard deployment workflow
kubectl get deployments                           # List deployments
kubectl scale deployment myapp --replicas=3      # Scale up/down
kubectl rollout status deployment/myapp          # Check rollout
kubectl rollout history deployment/myapp         # View history
kubectl rollout undo deployment/myapp            # Rollback if needed
```