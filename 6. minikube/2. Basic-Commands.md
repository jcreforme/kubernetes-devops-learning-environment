# 2. Basic Minikube Commands

## üéØ Learning Objectives
- [ ] Master essential minikube cluster lifecycle commands
- [ ] Understand cluster status monitoring and diagnostics
- [ ] Learn configuration management techniques
- [ ] Practice addon management and service exposure
- [ ] Implement basic troubleshooting workflows

## üìã Prerequisites
- Minikube installed and configured
- kubectl installed and configured
- Basic understanding of Kubernetes concepts

## üöÄ Step 1: Cluster Lifecycle Management

### Starting and Stopping Clusters
```bash
# Start minikube cluster with default settings
minikube start

# Start with specific configuration
minikube start --cpus=4 --memory=8192 --disk-size=40g

# Start with specific Kubernetes version
minikube start --kubernetes-version=v1.28.0

# Start with specific driver
minikube start --driver=docker

# Start with profile name (multiple clusters)
minikube start -p development
minikube start -p testing

# Stop minikube cluster
minikube stop

# Stop specific profile
minikube stop -p development

# Restart cluster (stop + start)
minikube restart

# Delete cluster completely
minikube delete

# Delete specific profile
minikube delete -p development

# Delete all clusters and profiles
minikube delete --all
```

### Cluster Status and Information
```bash
# Check cluster status
minikube status

# Check status of specific profile
minikube status -p development

# Get cluster information
minikube profile list

# Get current active profile
minikube profile

# Switch between profiles
minikube profile development
minikube profile testing

# Get IP address of cluster
minikube ip

# Get cluster info via kubectl
kubectl cluster-info

# Check node information
kubectl get nodes -o wide
```

## ‚öôÔ∏è Step 2: Configuration Management

### Setting Default Configuration
```bash
# Set default CPU allocation
minikube config set cpus 4

# Set default memory allocation (in MB)
minikube config set memory 8192

# Set default disk size
minikube config set disk-size 40g

# Set default driver
minikube config set driver docker

# Set default Kubernetes version
minikube config set kubernetes-version v1.28.0

# View all configuration
minikube config view

# Get specific configuration value
minikube config get memory
minikube config get driver

# Unset configuration
minikube config unset memory
```

### Profile-Specific Configuration
```bash
# Create configuration script for development profile
cat << 'EOF' > setup-dev-profile.sh
#!/bin/bash

echo "üîß Setting up development profile"

# Start development profile with specific settings
minikube start -p development \
  --cpus=4 \
  --memory=8192 \
  --disk-size=40g \
  --driver=docker \
  --kubernetes-version=v1.28.0 \
  --addons=ingress,dashboard,metrics-server

echo "‚úÖ Development profile ready"
minikube status -p development
EOF

chmod +x setup-dev-profile.sh

# Create configuration script for testing profile
cat << 'EOF' > setup-test-profile.sh
#!/bin/bash

echo "üß™ Setting up testing profile"

# Start testing profile with minimal resources
minikube start -p testing \
  --cpus=2 \
  --memory=4096 \
  --disk-size=20g \
  --driver=docker \
  --kubernetes-version=v1.28.0

echo "‚úÖ Testing profile ready"
minikube status -p testing
EOF

chmod +x setup-test-profile.sh
```

## üîå Step 3: Addon Management

### Essential Addons
```bash
# List all available addons
minikube addons list

# Enable essential addons
minikube addons enable dashboard
minikube addons enable ingress
minikube addons enable metrics-server
minikube addons enable storage-provisioner
minikube addons enable default-storageclass

# Enable multiple addons at once
minikube addons enable dashboard ingress metrics-server

# Disable addon
minikube addons disable dashboard

# Check addon status
minikube addons list | grep enabled
```

### Advanced Addons
```bash
# Enable registry addon for local development
minikube addons enable registry

# Enable istio for service mesh
minikube addons enable istio-provisioner
minikube addons enable istio

# Enable helm-tiller
minikube addons enable helm-tiller

# Enable nvidia-gpu-device-plugin (if available)
minikube addons enable nvidia-gpu-device-plugin

# Enable gcp-auth for Google Cloud integration
minikube addons enable gcp-auth
```

### Addon Configuration
```bash
# Configure ingress addon
minikube addons configure ingress

# Open addon configuration
minikube addons open ingress

# View addon configuration details
kubectl get all -n ingress-nginx
kubectl get all -n kubernetes-dashboard
```

## üåê Step 4: Service Access and Exposure

### Service URL Access
```bash
# Get service URL
minikube service <service-name>

# Get service URL without opening browser
minikube service <service-name> --url

# List all services with URLs
minikube service list

# Access service in specific namespace
minikube service <service-name> -n <namespace>

# Example: Access Kubernetes dashboard
minikube service kubernetes-dashboard -n kubernetes-dashboard
```

### Tunnel and Port Forwarding
```bash
# Create tunnel for LoadBalancer services
minikube tunnel

# Run tunnel in background
minikube tunnel > tunnel.log 2>&1 &

# Port forward to specific pod
kubectl port-forward pod/<pod-name> 8080:80

# Port forward to service
kubectl port-forward service/<service-name> 8080:80

# Example service exposure
cat << 'EOF' > test-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: test-service
spec:
  type: LoadBalancer
  ports:
  - port: 80
    targetPort: 8080
  selector:
    app: test-app
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: test-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: test-app
  template:
    metadata:
      labels:
        app: test-app
    spec:
      containers:
      - name: nginx
        image: nginx:alpine
        ports:
        - containerPort: 80
EOF

kubectl apply -f test-service.yaml
minikube service test-service --url
```

## üê≥ Step 5: Docker Integration

### Docker Environment
```bash
# Configure shell to use minikube's docker daemon
eval $(minikube docker-env)

# View docker environment configuration
minikube docker-env

# Build image directly in minikube
docker build -t myapp:local .

# List images in minikube
docker images

# Reset to host docker daemon
eval $(minikube docker-env -u)
```

### Registry Operations
```bash
# Enable registry addon
minikube addons enable registry

# Get registry URL
minikube service registry --url -n kube-system

# Tag and push image to minikube registry
docker tag myapp:latest localhost:32000/myapp:latest
docker push localhost:32000/myapp:latest

# Use image in deployment
kubectl create deployment test --image=localhost:32000/myapp:latest
```

## üîç Step 6: Monitoring and Diagnostics

### System Monitoring
```bash
# Check cluster resource usage
kubectl top nodes
kubectl top pods --all-namespaces

# View system pods
kubectl get pods -n kube-system

# Check cluster events
kubectl get events --sort-by=.metadata.creationTimestamp

# Monitor cluster in real-time
watch kubectl get pods --all-namespaces
```

### Logs and Debugging
```bash
# Get minikube logs
minikube logs

# Get logs for the last 20 lines
minikube logs --length=20

# Get logs and follow
minikube logs --follow

# SSH into minikube node
minikube ssh

# Execute commands in minikube node
minikube ssh -- docker ps
minikube ssh -- df -h
minikube ssh -- free -h

# View kubelet logs
minikube ssh -- sudo journalctl -u kubelet -f
```

### Performance Monitoring
```bash
# Create monitoring script
cat << 'EOF' > monitor-minikube.sh
#!/bin/bash

echo "üìä Minikube Cluster Monitoring"
echo "=============================="

echo "1. Cluster Status:"
minikube status

echo -e "\n2. Node Resources:"
kubectl top nodes

echo -e "\n3. Pod Resources:"
kubectl top pods --all-namespaces

echo -e "\n4. System Pods Status:"
kubectl get pods -n kube-system --no-headers | awk '{print $1 ": " $3}'

echo -e "\n5. Storage Usage:"
minikube ssh -- df -h | grep -E "(overlay|tmpfs)"

echo -e "\n6. Recent Events:"
kubectl get events --sort-by=.metadata.creationTimestamp | tail -10

echo -e "\n7. Active Services:"
minikube service list

echo -e "\n8. Enabled Addons:"
minikube addons list | grep enabled
EOF

chmod +x monitor-minikube.sh
./monitor-minikube.sh
```

## üõ†Ô∏è Step 7: Advanced Command Usage

### Batch Operations
```bash
# Create multi-cluster setup script
cat << 'EOF' > setup-multi-cluster.sh
#!/bin/bash

profiles=("development" "staging" "testing")

for profile in "${profiles[@]}"; do
    echo "üöÄ Setting up profile: $profile"
    
    case $profile in
        "development")
            minikube start -p $profile --cpus=4 --memory=8192 --disk-size=40g
            minikube addons enable ingress dashboard metrics-server -p $profile
            ;;
        "staging")
            minikube start -p $profile --cpus=3 --memory=6144 --disk-size=30g
            minikube addons enable ingress metrics-server -p $profile
            ;;
        "testing")
            minikube start -p $profile --cpus=2 --memory=4096 --disk-size=20g
            minikube addons enable metrics-server -p $profile
            ;;
    esac
    
    echo "‚úÖ Profile $profile ready"
    minikube status -p $profile
    echo "----------------------------------------"
done

echo "üéâ All profiles configured"
minikube profile list
EOF

chmod +x setup-multi-cluster.sh
```

### Cleanup and Maintenance
```bash
# Create cleanup script
cat << 'EOF' > cleanup-minikube.sh
#!/bin/bash

echo "üßπ Minikube Cleanup and Maintenance"
echo "=================================="

# Stop all running profiles
echo "1. Stopping all profiles..."
minikube profile list -o json | jq -r '.[].Name' | while read profile; do
    echo "  Stopping profile: $profile"
    minikube stop -p $profile
done

# Clean up docker images
echo "2. Cleaning up docker images..."
eval $(minikube docker-env)
docker system prune -f
docker image prune -f

# Reset docker environment
eval $(minikube docker-env -u)

# Clean up local files
echo "3. Cleaning up temporary files..."
rm -f tunnel.log
rm -f *.yaml

echo "4. Current profile status:"
minikube profile list

echo "‚úÖ Cleanup completed"
EOF

chmod +x cleanup-minikube.sh
```

## üìä Step 8: Dashboard and UI Access

### Kubernetes Dashboard
```bash
# Enable dashboard addon
minikube addons enable dashboard

# Open dashboard in browser
minikube dashboard

# Get dashboard URL without opening browser
minikube dashboard --url

# Access dashboard via port-forward
kubectl proxy --port=8001
# Then open: http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/
```

### Third-party UIs
```bash
# Deploy k9s (Kubernetes CLI UI)
# Install k9s first: https://k9scli.io/

# Run k9s
k9s

# Deploy Octant
# Install octant first: https://octant.dev/

# Run octant
octant

# Access via browser at http://localhost:7777
```

## üîß Step 9: Troubleshooting Commands

### Common Issues
```bash
# Issue: Cluster won't start
minikube delete
minikube start --v=7 --alsologtostderr

# Issue: Out of disk space
minikube ssh -- df -h
minikube config set disk-size 50g
minikube delete && minikube start

# Issue: Memory issues
minikube config set memory 8192
minikube restart

# Issue: Network problems
minikube ssh -- ping 8.8.8.8
minikube ssh -- nslookup google.com

# Issue: Docker daemon problems
minikube ssh -- sudo systemctl status docker
minikube ssh -- sudo systemctl restart docker
```

### Diagnostic Information Collection
```bash
# Create diagnostic script
cat << 'EOF' > diagnose-minikube.sh
#!/bin/bash

output_dir="minikube-diagnostics-$(date +%Y%m%d-%H%M%S)"
mkdir -p $output_dir

echo "üîç Collecting minikube diagnostics..."

# Basic information
minikube version > $output_dir/version.txt
minikube status > $output_dir/status.txt
minikube profile list > $output_dir/profiles.txt
minikube config view > $output_dir/config.txt

# Cluster information
kubectl cluster-info > $output_dir/cluster-info.txt
kubectl get nodes -o wide > $output_dir/nodes.txt
kubectl get pods --all-namespaces > $output_dir/all-pods.txt

# Logs
minikube logs > $output_dir/minikube-logs.txt

# System information
minikube ssh -- 'cat /proc/cpuinfo' > $output_dir/cpu-info.txt
minikube ssh -- 'free -h' > $output_dir/memory-info.txt
minikube ssh -- 'df -h' > $output_dir/disk-info.txt

echo "üìÅ Diagnostics saved to: $output_dir"
echo "üéØ Include this information when reporting issues"
EOF

chmod +x diagnose-minikube.sh
```

## ‚úÖ Success Criteria

### ‚úÖ Command Mastery Checklist
- [ ] Can start/stop/restart minikube clusters
- [ ] Understand profile management and switching
- [ ] Can configure cluster resources (CPU, memory, disk)
- [ ] Master addon enabling/disabling
- [ ] Can expose and access services
- [ ] Understand Docker integration
- [ ] Can troubleshoot common issues
- [ ] Proficient with monitoring and diagnostics

### ‚úÖ Validation Commands
```bash
# Test all basic operations:
minikube start
minikube status
minikube addons enable dashboard
minikube service list
minikube dashboard --url
minikube logs | head -10
minikube ssh -- uptime
minikube stop
```

## üéØ Next Steps

After mastering basic commands:

1. **Profile Management** - Learn advanced multi-cluster setups
2. **Addon Ecosystem** - Explore specialized addons for development
3. **Integration Workflows** - Combine minikube with CI/CD pipelines
4. **Performance Tuning** - Optimize resource allocation
5. **Advanced Networking** - Learn ingress and service mesh configuration

## üìö Key Takeaways

### What You've Learned
1. **Lifecycle Management**: Starting, stopping, and maintaining minikube clusters
2. **Configuration**: Setting defaults and profile-specific configurations
3. **Addon Ecosystem**: Installing and managing cluster extensions
4. **Service Access**: Exposing applications and accessing UIs
5. **Troubleshooting**: Diagnosing and fixing common issues

### Best Practices Implemented
- Automated profile setup and configuration
- Comprehensive monitoring and diagnostics
- Proper cleanup and maintenance procedures
- Systematic troubleshooting approaches
- Integration with development workflows

These fundamental commands form the foundation for all minikube operations and development workflows.